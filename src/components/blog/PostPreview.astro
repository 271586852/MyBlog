---
import type { CollectionEntry } from 'astro:content'

import FormattedDate from '../FormattedDate.astro'
import Button from '../Button.astro'
import { cn } from '@/utils'

type Props = {
  post: CollectionEntry<'post'>
  detailed?: boolean
  class?: string
}

const {
  post: { data, slug, render },
  detailed = false,
  class: className
} = Astro.props
const postDate = data.updatedDate ?? data.publishDate

const { remarkPluginFrontmatter } = await render()
---

<li class={cn('list-none', className)}>
  <article class="interactive-card" data-tilt>
    <div class="post-meta">
      <span style="font-family: var(--font-mono); text-transform: uppercase;">
        {data.draft ? 'DRAFT' : 'POST'}
      </span>
      <FormattedDate 
        date={postDate} 
        class="text-xs"
        style="font-family: var(--font-mono);"
      />
    </div>
    <div class="card-inner">
      <a
        href={`/blog/${slug}`}
        data-astro-prefetch
        style="text-decoration: none; color: inherit; display: block;"
      >
        <h2 style="color: var(--text-main); margin-bottom: 10px; font-size: 1.25rem; font-weight: 600;">
          {data.draft && <span style="color: #ff4444;">(Draft) </span>}
          {data.title}
        </h2>
        {
          detailed && (
            <>
              <p style="color: var(--text-dim); font-size: 14px; line-height: 1.6; margin-bottom: 15px;">
                {data.description}
              </p>
              <div style="display: flex; align-items: center; gap: 15px; font-size: 12px; color: var(--text-dim); font-family: var(--font-mono);">
                <span style="display: flex; align-items: center; gap: 5px;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                  {remarkPluginFrontmatter.minutesRead} min
                </span>
                {data.language && (
                  <span style="display: flex; align-items: center; gap: 5px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="2" y1="12" x2="22" y2="12"></line>
                      <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                    </svg>
                    {data.language}
                  </span>
                )}
              </div>
            </>
          )
        }
      </a>
      <!-- tags -->
      {
        detailed && data.tags && (
          <ul style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
            {data.tags.map((tag: string) => (
              <li>
                <Button title={tag} href={`/tags/${tag}`} style='pill' />
              </li>
            ))}
          </ul>
        )
      }
    </div>
  </article>
</li>

