---
export const prerender = true

import type { GetStaticPaths, Page } from 'astro'
import type { CollectionEntry } from 'astro:content'

import { siteConfig } from '@/site-config'
import Pagination from '@/components/blog/Paginator.astro'
import PostPreview from '@/components/blog/PostPreview.astro'
import PageLayout from '@/layouts/BaseLayout.astro'
import { getAllPosts, sortMDByDate } from '@/utils'

export const getStaticPaths = (async ({ paginate }) => {
  const allPosts = await getAllPosts()
  const allPostsByDate = sortMDByDate(allPosts)
  const totalPosts = allPosts.length
  return paginate(allPostsByDate, {
    pageSize: siteConfig.pageSize,
    props: { totalPosts }
  })
}) satisfies GetStaticPaths

interface Props {
  page: Page<CollectionEntry<'post'>>
  totalPosts: number
}

const { page, totalPosts } = Astro.props

const meta = {
  description: 'Some posts or archieves of my blog',
  title: 'Blog'
}

const paginationProps = {
  ...(page.url.prev && {
    prevUrl: {
      text: `← Previous Posts`,
      url: page.url.prev
    }
  }),
  ...(page.url.next && {
    nextUrl: {
      text: `Next Posts →`,
      url: page.url.next
    }
  })
}
---

<PageLayout meta={meta}>
  <div class='w-full'>
    <header class="header-title">
      <span style="font-family: var(--font-mono);">BLOG // ARCHIVE</span>
      POSTS<br>LIST
    </header>

    {
      page.data.length === 0 ? (
        <p style="color: var(--text-dim);">No posts yet.</p>
      ) : (
        <>
          <div style="margin-bottom: 20px; font-family: var(--font-mono); font-size: 12px; color: var(--text-dim);">
            Page {page.currentPage} - Showing {page.data.length} of {totalPosts} posts
          </div>
          <ul class='flex flex-col gap-y-4 text-start' style="list-style: none; padding: 0;">
            {page.data.map((p) => (
              <PostPreview post={p} detailed />
            ))}
          </ul>
          <Pagination {...paginationProps} />
        </>
      )
    }
  </div>
</PageLayout>
